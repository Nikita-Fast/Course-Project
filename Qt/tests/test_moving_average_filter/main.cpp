#include <QtTest>
#include <vector>
#include "moving_average_filter.h"

class TestMovingAverageFilter : public QObject {
  Q_OBJECT

 public:
  TestMovingAverageFilter();
  ~TestMovingAverageFilter();

 private slots:
  void test_filter();
};

TestMovingAverageFilter::TestMovingAverageFilter() {}

TestMovingAverageFilter::~TestMovingAverageFilter() {}

void TestMovingAverageFilter::test_filter() {
  int window_size = 4;
  MovingAverageFilter filter(window_size);

  std::vector<short> v = {
      -143, 253,   163,  276,   625,   621,  810,  895,  979,  923,  872,  1055,
      1131, 974,   1017, 1000,  995,   869,  781,  710,  754,  484,  402,  54,
      20,   7,     -257, -115,  -205,  -292, -508, -715, -807, -822, -771, -923,
      -972, -1023, -904, -1058, -1003, -917, -807, -776, -706, -657, -500, -358,
      -252, -211,  -67,  -16,   174,   95,   366,  553,  641,  616,  918,  925,
      924,  981,   936,  1035,  971,   957,  1003, 853,  856,  714,  834,  612,
      573,  302,   292,  237,   -5,    -21,  -180, -433, -638, -500, -697, -822,
      -916, -819,  -995, -986,  -991,  -993, -958, -845, -924, -773, -783, -802,
      -524, -588,  -529, -362,  -197,  -178, 86,   157,  421,  294,  539,  650,
      737,  782,   837,  868,   988,   988,  1054, 936,  981,  956,  990,  756,
      724,  682,   664,  446,   412,   274,  210,  -44};

  filter.filter(v);

  std::vector<short> expected = {
      -35,  27,   68,   137,  329,  421,  583,  737,  826,  901,  917,  957,
      995,  1008, 1044, 1030, 996,  970,  911,  838,  778,  682,  587,  423,
      240,  120,  -44,  -86,  -142, -217, -280, -430, -580, -713, -778, -830,
      -872, -922, -955, -989, -997, -970, -946, -875, -801, -736, -659, -555,
      -441, -330, -222, -136, -30,  46,   154,  297,  413,  544,  682,  775,
      845,  937,  941,  969,  980,  974,  991,  946,  917,  856,  814,  754,
      683,  580,  444,  351,  206,  125,  7,    -159, -318, -437, -567, -664,
      -733, -813, -888, -929, -947, -991, -982, -946, -930, -875, -831, -820,
      -720, -674, -610, -500, -419, -316, -162, -33,  121,  239,  352,  476,
      555,  677,  751,  806,  868,  920,  974,  991,  989,  981,  965,  920,
      856,  788,  706,  629,  551,  449,  335,  213};

  QCOMPARE(expected, v);
}

QTEST_APPLESS_MAIN(TestMovingAverageFilter)

#include "main.moc"
